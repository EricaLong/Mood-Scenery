<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mood Scenery</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    html, body {
      height: 100%;
      overflow: hidden;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      background: #000;
    }

    /* â”€â”€ Background video (covers viewport, matches aspect by cropping) â”€â”€ */
    .bg-video-wrap {
      position: fixed;
      inset: 0;
      z-index: 1;
      overflow: hidden;
    }

    #bg-video {
      position: absolute;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      width: auto;
      height: auto;
      transform: translate(-50%, -50%);
      object-fit: cover;
      transition: opacity 2.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* â”€â”€ Blur overlay â”€â”€ */
    .blur-overlay {
      position: fixed;
      inset: 0;
      z-index: 2;
      backdrop-filter: blur(40px) saturate(1.2);
      -webkit-backdrop-filter: blur(40px) saturate(1.2);
      background: rgba(0, 0, 0, 0.15);
      transition: backdrop-filter 2s cubic-bezier(0.4, 0, 0.2, 1),
                  -webkit-backdrop-filter 2s cubic-bezier(0.4, 0, 0.2, 1),
                  background 2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .blur-overlay.clear {
      backdrop-filter: blur(0px) saturate(1.1);
      -webkit-backdrop-filter: blur(0px) saturate(1.1);
      background: rgba(0, 0, 0, 0.05);
    }

    /* â”€â”€ UI layer â”€â”€ */
    .ui-layer {
      position: fixed;
      inset: 0;
      z-index: 10;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    /* â”€â”€ Close button â”€â”€ */
    .close-btn {
      position: fixed;
      top: 24px;
      right: 28px;
      z-index: 15;
      width: 36px;
      height: 36px;
      border: none;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                  background 0.3s ease,
                  transform 0.2s cubic-bezier(0.22, 1, 0.36, 1);
      -webkit-tap-highlight-color: transparent;
    }

    .close-btn.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.15);
    }

    .close-btn:active {
      transform: scale(0.92);
    }

    .close-btn svg {
      width: 14px;
      height: 14px;
      stroke: rgba(255, 255, 255, 0.6);
      stroke-width: 1.5;
      transition: stroke 0.3s ease;
    }

    .close-btn:hover svg {
      stroke: rgba(255, 255, 255, 0.9);
    }

    /* â”€â”€ Prompt container â”€â”€ */
    .prompt-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 40px;
      width: 927px;
      max-width: calc(100% - 48px);
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      transition: top 1.4s cubic-bezier(0.22, 1, 0.36, 1),
                  transform 1.4s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .prompt-container.at-top {
      top: 40px;
      transform: translate(-50%, 0);
    }

    /* â”€â”€ Heading â”€â”€ */
    .heading {
      font-size: 32px;
      font-weight: 300;
      line-height: 1.5;
      letter-spacing: -0.02em;
      color: rgba(255, 255, 255, 0.92);
      text-align: center;
      width: 100%;
      transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .heading.hidden {
      opacity: 0;
      pointer-events: none;
    }

    /* â”€â”€ Input area â”€â”€ */
    .input-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 36px;
      width: 100%;
    }

    .input-wrap {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      width: 520px;
      max-width: 100%;
      cursor: text;
      position: relative;
    }

    .mood-input {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      font-family: 'Inter', sans-serif;
      font-size: 20px;
      font-weight: 300;
      line-height: 48px;
      letter-spacing: -0.01em;
      text-align: center;
      color: #fff;
      caret-color: rgba(255, 255, 255, 0.6);
      transition: font-size 1s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .mood-input::placeholder {
      color: rgba(255, 255, 255, 0.3);
      font-weight: 300;
    }

    .prompt-container.at-top .mood-input {
      font-size: 16px;
      font-weight: 400;
    }

    /* â”€â”€ Meteor underline â”€â”€ */
    .input-underline {
      width: 100%;
      height: 1px;
      background: rgba(255, 255, 255, 0.12);
      position: relative;
      overflow: hidden;
      transition: opacity 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .input-underline::after {
      content: '';
      position: absolute;
      top: 0;
      left: -40%;
      width: 40%;
      height: 100%;
      background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 255, 255, 0.1) 20%,
        rgba(255, 255, 255, 0.8) 60%,
        rgba(255, 255, 255, 1) 80%,
        transparent 100%
      );
      opacity: 0;
      transition: opacity 0.4s ease;
    }

    .input-wrap.focused .input-underline::after {
      opacity: 1;
      animation: meteor 2.4s cubic-bezier(0.4, 0, 0.2, 1) infinite;
    }

    @keyframes meteor {
      0%   { left: -40%; }
      100% { left: 110%; }
    }

    /* â”€â”€ Display mode: input looks like static text â”€â”€ */
    .input-wrap.display-mode .input-underline {
      opacity: 0;
    }

    .input-wrap.display-mode .mood-input {
      cursor: pointer;
      color: rgba(255, 255, 255, 0.88);
    }

    .input-wrap.display-mode .mood-input:hover {
      color: #fff;
    }

    /* â”€â”€ Glass pills â”€â”€ */
    .pills {
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      width: 100%;
      transition: opacity 0.8s cubic-bezier(0.4, 0, 0.2, 1),
                  transform 0.8s cubic-bezier(0.22, 1, 0.36, 1);
    }

    .pills.hidden {
      opacity: 0;
      transform: translateY(12px);
      pointer-events: none;
    }

    .pill {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 0 20px;
      height: 48px;
      border: 1px solid rgba(255, 255, 255, 0.15);
      border-radius: 100px;
      background: rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(12px) saturate(1.4);
      -webkit-backdrop-filter: blur(12px) saturate(1.4);
      cursor: pointer;
      color: #fff;
      font-family: inherit;
      transition: background 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                  border-color 0.35s cubic-bezier(0.4, 0, 0.2, 1),
                  transform 0.2s cubic-bezier(0.22, 1, 0.36, 1),
                  box-shadow 0.35s cubic-bezier(0.4, 0, 0.2, 1);
      -webkit-tap-highlight-color: transparent;
      overflow: hidden;
      flex-shrink: 0;
    }

    .pill:hover {
      background: rgba(255, 255, 255, 0.12);
      border-color: rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 24px rgba(255, 255, 255, 0.06);
    }

    .pill:active {
      transform: scale(0.96);
    }

    .pill-emoji {
      font-size: 20px;
      line-height: 1;
      display: inline-block;
      transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .pill:hover .pill-emoji {
      transform: rotate(-12deg) scale(1.15);
    }

    .pill-text {
      font-size: 13px;
      font-weight: 400;
      letter-spacing: 0.01em;
      line-height: 48px;
      white-space: nowrap;
      color: rgba(255, 255, 255, 0.8);
    }

    .pill:hover .pill-text {
      color: #fff;
    }

    /* â”€â”€ Credit â”€â”€ */
    .credit {
      position: fixed;
      bottom: 24px;
      right: 32px;
      font-size: 10px;
      font-weight: 300;
      letter-spacing: 0.06em;
      color: rgba(255, 255, 255, 0.18);
      z-index: 11;
    }

    .credit a {
      color: rgba(255, 255, 255, 0.18);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .credit a:hover {
      color: rgba(255, 255, 255, 0.4);
    }

    /* â”€â”€ Loading bar â”€â”€ */
    .loading-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 0;
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
      z-index: 20;
      transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease;
      opacity: 0;
    }

    .loading-bar.active {
      opacity: 1;
    }
  </style>
</head>
<body>

<!-- Background video -->
<div class="bg-video-wrap">
  <video id="bg-video" autoplay muted loop playsinline></video>
</div>

<!-- Blur overlay -->
<div class="blur-overlay" id="blurOverlay"></div>

<!-- Loading bar -->
<div class="loading-bar" id="loadingBar"></div>

<!-- Close button -->
<button class="close-btn" id="closeBtn" aria-label="Return to start">
  <svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
  </svg>
</button>

<!-- UI -->
<div class="ui-layer">
  <div class="prompt-container" id="promptContainer">
    <!-- Heading -->
    <h1 class="heading" id="heading">How are you feeling today?</h1>

    <!-- Input area -->
    <div class="input-area" id="inputArea">
      <!-- Single input: toggles between display and edit mode -->
      <div class="input-wrap" id="inputWrap">
        <input class="mood-input" id="moodInput" type="text" placeholder="Calm, cozy, freeâ€¦" autocomplete="off" spellcheck="false">
        <div class="input-underline"></div>
      </div>

      <!-- Prompt pills (dynamically generated) -->
      <div class="pills" id="pills"></div>
    </div>
  </div>
</div>

<div class="credit">Videos from <a href="https://www.pexels.com" target="_blank" rel="noopener">Pexels</a></div>

<script>
  // â”€â”€ Default placeholder text â”€â”€
  const defaultPlaceholder = 'Calm, cozy, freeâ€¦';

  // â”€â”€ Pexels API (get a free key at https://www.pexels.com/api) â”€â”€
  const PEXELS_API_KEY = 'CEvAF2LZYUCe3YBUGlnsL1SPVx2wJLC36eLAU2YyoHwIudwf5U6MmsmB';

  const PEXELS_VIDEOS_SEARCH = 'https://api.pexels.com/videos/search';

  // Fallback search if mood returns no results
  const DEFAULT_VIDEO_QUERY = 'calm nature';

  // â”€â”€ Pexels: fetch videos and pick best file for background (landscape, HD when possible) â”€â”€
  async function fetchPexelsVideos(query) {
    const url = `${PEXELS_VIDEOS_SEARCH}?query=${encodeURIComponent(query)}&per_page=15`;
    const res = await fetch(url, { headers: { Authorization: PEXELS_API_KEY } });
    if (!res.ok) throw new Error('Pexels request failed');
    const data = await res.json();
    return data.videos || [];
  }

  function pickBestVideoFile(video) {
    const files = video.video_files || [];
    const landscape = files.filter(f => f.width >= f.height && f.width >= 1280);
    const pool = landscape.length ? landscape : files;
    const byWidth = [...pool].sort((a, b) => (b.width || 0) - (a.width || 0));
    return byWidth[0]?.link || pool[0]?.link;
  }

  async function getVideoUrlForMood(mood) {
    const query = mood.trim() || DEFAULT_VIDEO_QUERY;
    let videos = await fetchPexelsVideos(query);
    if (!videos.length) videos = await fetchPexelsVideos(DEFAULT_VIDEO_QUERY);
    if (!videos.length) throw new Error('No videos found');
    const video = videos[Math.floor(Math.random() * videos.length)];
    const link = pickBestVideoFile(video);
    if (!link) throw new Error('No video file');
    return link;
  }

  function preloadVideo(url) {
    return new Promise((resolve, reject) => {
      const v = document.createElement('video');
      v.muted = true;
      v.playsInline = true;
      v.preload = 'auto';
      v.oncanplaythrough = () => resolve(url);
      v.onerror = () => reject(new Error('Video failed to load'));
      v.src = url;
    });
  }

  // â”€â”€ Elements â”€â”€
  const promptContainer = document.getElementById('promptContainer');
  const heading = document.getElementById('heading');
  const moodInput = document.getElementById('moodInput');
  const inputWrap = document.getElementById('inputWrap');
  const pillsContainer = document.getElementById('pills');
  const blurOverlay = document.getElementById('blurOverlay');
  const bgVideo = document.getElementById('bg-video');
  const loadingBar = document.getElementById('loadingBar');
  const closeBtn = document.getElementById('closeBtn');

  let defaultVideoUrl = '';
  let currentState = 'entry';
  let currentMood = '';
  let hasTriggeredOnce = false;
  let isDisplayMode = false;

  // â”€â”€ Focus tracking for meteor animation â”€â”€
  moodInput.addEventListener('focus', () => {
    inputWrap.classList.add('focused');
    if (isDisplayMode) {
      enterEditing();
    }
    // Set cursor position to the beginning
    setTimeout(() => {
      moodInput.setSelectionRange(0, 0);
    }, 0);
  });
  moodInput.addEventListener('blur', () => inputWrap.classList.remove('focused'));

  // Keep cursor at start when input is empty (placeholder visible)
  moodInput.addEventListener('click', () => {
    if (moodInput.value.length === 0) {
      moodInput.setSelectionRange(0, 0);
    }
  });
  moodInput.addEventListener('mousedown', (e) => {
    if (moodInput.value.length === 0) {
      e.preventDefault();
      moodInput.focus();
      moodInput.setSelectionRange(0, 0);
    }
  });

  // â”€â”€ Dynamic mood pool â”€â”€
  const moodPool = [
    { emoji: 'ðŸƒ', mood: 'Quiet Longing' },
    { emoji: 'ðŸŒ†', mood: 'Warm Nostalgia' },
    { emoji: 'ðŸžï¸', mood: 'Calm Clarity' },
    { emoji: 'ðŸ˜', mood: 'Electric Anticipation' },
    { emoji: 'ðŸ¥°', mood: 'Soft Romance' },
    { emoji: 'ðŸŒ§ï¸', mood: 'Rainy Melancholy' },
    { emoji: 'ðŸŒ…', mood: 'Golden Sunset' },
    { emoji: 'ðŸŒŠ', mood: 'Ocean Serenity' },
    { emoji: 'âœ¨', mood: 'Starlit Wonder' },
    { emoji: 'ðŸŒ¸', mood: 'Cherry Blossom Peace' },
    { emoji: 'ðŸ”¥', mood: 'Fiery Passion' },
    { emoji: 'ðŸŒ™', mood: 'Midnight Stillness' },
    { emoji: 'ðŸŽ¶', mood: 'Musical Bliss' },
    { emoji: 'ðŸ‚', mood: 'Autumn Reflection' },
    { emoji: 'â„ï¸', mood: 'Winter Silence' },
    { emoji: 'ðŸŒ¿', mood: 'Forest Tranquility' },
    { emoji: 'ðŸ’«', mood: 'Dreamy Wanderlust' },
    { emoji: 'ðŸŒ»', mood: 'Sunny Optimism' },
    { emoji: 'ðŸŽ†', mood: 'Festive Energy' },
    { emoji: 'ðŸ•Šï¸', mood: 'Gentle Hope' },
    { emoji: 'ðŸŒŒ', mood: 'Cosmic Solitude' },
    { emoji: 'â˜•', mood: 'Cozy Comfort' },
    { emoji: 'ðŸ¦‹', mood: 'Playful Freedom' },
    { emoji: 'ðŸŽ­', mood: 'Bittersweet Joy' },
    { emoji: 'ðŸ”ï¸', mood: 'Mountain Grandeur' },
    { emoji: 'ðŸ’œ', mood: 'Soft Tenderness' },
    { emoji: 'â›ˆï¸', mood: 'Stormy Intensity' },
    { emoji: 'ðŸŒ¾', mood: 'Pastoral Calm' },
    { emoji: 'ðŸŽª', mood: 'Wild Excitement' },
    { emoji: 'ðŸª·', mood: 'Inner Stillness' },
  ];

  function shuffle(arr) {
    const a = [...arr];
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function generatePills() {
    const picked = shuffle(moodPool).slice(0, 5);
    pillsContainer.innerHTML = picked.map(p =>
      `<button class="pill" data-mood="${p.mood}">
        <span class="pill-emoji">${p.emoji}</span>
        <span class="pill-text">${p.mood}</span>
      </button>`
    ).join('');
  }

  generatePills();

  // â”€â”€ Loading bar â”€â”€
  function showLoading() {
    loadingBar.style.transition = 'none';
    loadingBar.style.width = '0';
    loadingBar.classList.add('active');
    void loadingBar.offsetWidth;
    loadingBar.style.transition = 'width 1.2s cubic-bezier(0.4, 0, 0.2, 1), opacity 0.5s ease';
    loadingBar.style.width = '70%';
  }

  function hideLoading() {
    loadingBar.style.width = '100%';
    setTimeout(() => loadingBar.classList.remove('active'), 400);
  }

  // â”€â”€ Trigger mood â”€â”€
  async function triggerMood(mood) {
    if (!mood.trim()) return;

    currentMood = mood.trim();
    currentState = 'clear';
    hasTriggeredOnce = true;

    showLoading();

    let videoUrl;
    try {
      videoUrl = await getVideoUrlForMood(currentMood);
      await preloadVideo(videoUrl);
    } catch {
      videoUrl = defaultVideoUrl || '';
    }

    hideLoading();

    if (videoUrl) {
      bgVideo.style.opacity = '0';
      setTimeout(() => {
        bgVideo.src = videoUrl;
        bgVideo.load();
        bgVideo.play().catch(() => {});
        bgVideo.style.opacity = '1';
      }, 400);
    }

    // Clear blur
    blurOverlay.classList.add('clear');

    // Move to top
    promptContainer.classList.add('at-top');
    heading.classList.add('hidden');
    pillsContainer.classList.add('hidden');

    // Switch input to display mode
    isDisplayMode = true;
    moodInput.value = currentMood;
    moodInput.readOnly = true;
    moodInput.placeholder = '';
    inputWrap.classList.add('display-mode');
    moodInput.blur();

    // Show close button
    closeBtn.classList.add('visible');
  }

  // â”€â”€ Enter editing â”€â”€
  function enterEditing() {
    currentState = 'editing';
    isDisplayMode = false;

    // Blur background
    blurOverlay.classList.remove('clear');

    // Keep at top after first trigger
    if (hasTriggeredOnce) {
      promptContainer.classList.add('at-top');
      heading.classList.add('hidden');
    } else {
      promptContainer.classList.remove('at-top');
      heading.classList.remove('hidden');
    }

    // Switch input to editable
    moodInput.readOnly = false;
    moodInput.placeholder = defaultPlaceholder;
    inputWrap.classList.remove('display-mode');

    // Regenerate pills
    generatePills();
    pillsContainer.classList.remove('hidden');

    // Pre-fill and select
    moodInput.value = currentMood;

    setTimeout(() => {
      moodInput.focus();
      moodInput.select();
    }, 50);
  }

  // â”€â”€ Reset to initial state â”€â”€
  function resetToDefault() {
    currentState = 'entry';
    currentMood = '';
    hasTriggeredOnce = false;
    isDisplayMode = false;

    // Hide close button
    closeBtn.classList.remove('visible');

    // Restore blur
    blurOverlay.classList.remove('clear');

    // Move prompt back to center
    promptContainer.classList.remove('at-top');

    // Show heading
    heading.classList.remove('hidden');

    // Reset input
    moodInput.readOnly = false;
    moodInput.value = '';
    moodInput.placeholder = defaultPlaceholder;
    inputWrap.classList.remove('display-mode');

    // Regenerate and show pills
    generatePills();
    pillsContainer.classList.remove('hidden');

    // Switch back to default video
    if (defaultVideoUrl) {
      bgVideo.style.opacity = '0';
      setTimeout(() => {
        bgVideo.src = defaultVideoUrl;
        bgVideo.load();
        bgVideo.play().catch(() => {});
        bgVideo.style.opacity = '1';
      }, 400);
    }

    // Focus input after transition
    setTimeout(() => {
      moodInput.focus();
      moodInput.setSelectionRange(0, 0);
    }, 600);
  }

  // â”€â”€ Events â”€â”€
  moodInput.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && moodInput.value.trim()) {
      triggerMood(moodInput.value.trim());
      moodInput.blur();
    }
  });

  closeBtn.addEventListener('click', () => resetToDefault());

  pillsContainer.addEventListener('click', (e) => {
    const pill = e.target.closest('.pill');
    if (!pill) return;
    const mood = pill.dataset.mood;
    moodInput.value = mood;
    triggerMood(mood);
  });

  // Load default background video on start
  (async function setDefaultVideo() {
    try {
      const url = await getVideoUrlForMood(DEFAULT_VIDEO_QUERY);
      defaultVideoUrl = url;
      bgVideo.src = url;
      bgVideo.play().catch(() => {});
    } catch (_) {}
  })();

  // Focus on load
  setTimeout(() => {
    moodInput.focus();
    moodInput.setSelectionRange(0, 0);
  }, 600);
</script>

</body>
</html>
